<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="root-page">
  <template>

      <theme-drawer></theme-drawer>

  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'root-page',

        ready: function() {
          this._loadElement(app.settings.theme);
          this._buildPageArray();
        },

        _buildPageArray: function() {
          this.pages = [];
          this.menuItems = [];
          var hardPages = app.settings.hardPages;
          var softPages = app.settings.softPages;
          for (var i = 0; i < hardPages.length; i++) { // Add hard pages
            var slug = hardPages[i].title.toLowerCase().replace(/[^\s\w+\-_#.]/g, '').replace(/\s+/g, '-');
            var route = '';
            if (slug === 'home') {
              route = '/';
            } else {
              route = '/' + slug;
            }
            if (hardPages[i].addToMenu) {
              var menuItem = {
                title: hardPages[i].title,
                route: route
              };
              this.push('menuItems', menuItem);
            }
            var page = {
              title: hardPages[i].title,
              route: route,
              slug: slug,
              type: "hard"
            };
            this.push('pages', page);
          }
          for (var i = 0; i < softPages.length; i++) { // Add soft pages
            var slug = hardPages[i].title.toLowerCase().replace(/[^\s\w+\-_#.]/g, '').replace(/\s+/g, '-');
            var route = '/' + slug;
            if (softPages[i].addToMenu) {
              var menuItem = {
                title: softPages[i].title,
                route: route
              };
              this.push('menuItems', menuItem);
            }
            page = {
              title: softPages[i].title,
              route: route,
              slug: slug,
              type: "soft"
            };
            this.push('pages', page);
          }
          app.pages = this.pages;
          app.pagesLoaded = true;
//          this.$.serviceRouting.initializePage();
        },
        
        _loadElement: function(name) {
          this.importHref('../elements/themes/theme-' + name + '.html', function() {
            app.debug('theme-' + name + ' loaded');
          }.bind(this), function() {
            app.toast('Error 1: ' + name + ' theme failed to load', 'http://blogdown.info/error/1', '_blank');
            app.debug('theme-' + name + ' failed to load', 'warn');
          }.bind(this));
        }
      });
    })();
  </script>

</dom-module>
