<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="root-page">
  <template>
    <style>
      paper-progress {
        width: 100%;
      }
    </style>

    <excess-route id="router" route="/:first"></excess-route>

    <paper-drawer-panel id="drawer" narrow="[[mobile]]">
      <!-- Drawer -->
      <div id="drawer" drawer>
        <paper-menu>
          <template is="dom-repeat" items="[[pages]]" as="page">
            <paper-item id="[[page.route]]" on-click="_goToPage">[[page.title]]</paper-item>
          </template>
        </paper-menu>
      </div>
      <!-- End Drawer -->

      <!-- Header -->
      <paper-header-panel main>
        <paper-toolbar>
          <template is="dom-if" if="[[loading]]" restamp>
            <iron-flex-layout class="fit">
              <paper-progress indeterminate="[[!progress]]"></paper-progress>
            </iron-flex-layout>
          </template>
          <template is="dom-if" if="[[progress]]" restamp>
            <iron-flex-layout class="fit">
              <paper-progress value="[[progressAmount]]"></paper-progress>
            </iron-flex-layout>
          </template>
          <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
          <div class="title">[[pageTitle]]</div>
          <template is="dom-repeat" items="[[settings.socialAccounts]]" as="socialAccount">
              <paper-icon-button icon="fa:[[socialAccount.type]]" on-click="_goToSocialPage"></paper-icon-button>
          </template>
        </paper-toolbar>
        <!-- End Header -->

        <!-- Content -->
        <div class="content">
          <paper-button on-click="reval">Reval</paper-button>
          <iron-pages attr-for-selected="data-route" selected="[[route]]">

            <template is="dom-repeat" items="[[pages]]" as="page">
              <section data-route="[[page.route]]">
                <template is="dom-if" if="[[page.active]]" restamp>
                  <dynamic-element elementName="home-[[page.route]]"></dynamic-element>
                </template>
              </section>
            </template>

          </iron-pages>
        </div>
      </paper-header-panel>
      <!-- End content -->
    </paper-drawer-panel>

  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'root-page',

        ready: function() {
          app.loading = true;
          app.progress = false;
          this._buildPageArray();
          this.set('pageTitle', app.pageTitle);
          this.set('loading', app.loading);
          this.set('progress', app.progress);
          this.set('progressAmount', app.progressAmount);
          this.set('route', app.route);
          this.set('mobile', app.mobile);
          console.log(this.first);
        },

        reval: function() {
      //    window.open('#/blablabla/bksdfk', '_self');
          console.log('revaluating');
          console.log(this.$.router.first);
          console.log(this.route);
          console.log(this.first);
          Excess.RouteManager.navigateTo('/users/999');
        },

        pageRedirect: function(slug) {
          page.redirect(slug);
        },

        _goToPage: function(e) {
          var model = e.model;
          app.goTo(model.page.slug);
          console.log('I just went to ' + model.page.slug);
        },

        _goToSocialPage: function(e) {
          var model = e.model;
          window.open(model.socialAccount.url);
        },


      });
    })();
  </script>

</dom-module>
