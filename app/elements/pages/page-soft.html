<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="page-soft">
  <template>
    
    <paper-card heading="[[page.title]]" class="fullbleed">
      <template is="dom-if" if="[[isMD]]" restamp>
        <div class="card-content">
          <juicy-markdown value="[[pageResponseData]]"></juicy-markdown>
        </div>
      </template>
      <template is="dom-if" if="[[isHTML]]" restamp>
        <div class="card-content">
          <template is="juicy-html" content$="[[pageResponseData]]"></template>
        </div>
      </template>
      <template is="dom-if" if="[[isPDF]]" restamp>
        <div class="card-content">
          <pdf-object file="[[pageUrl]]" height="400px"></pdf-object>
        </div>
        <div class="card-actions">
          <paper-button on-click="_download">Fullscreen</paper-button>
        </div>
      </template>
    </paper-card>
    
    <iron-ajax id="page"
      url="[[pageUrl]]"
      handle-as="text"
      on-response="pageResponse"
      on-error="pageError"
      last-response="{{pageResponseData}}"
    ></iron-ajax>
    
  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'page-soft',
        
        properties: {
          pageResponseData: {
            type: String
          },
          page: {
            type: Object,
            observer: '_pageChanged'
          }
        },
        
        _pageChanged: function() {
          this.pageUrl = '../../pages/' + this.page.slug + '.' + this.page.format;
          if (this.page.format === 'md' || this.page.format === 'html') {
            this.$.page.generateRequest();
          } else {
            this._loadPage();
          }
        },
        
        pageResponse: function() {
          this._loadPage();
        },
        
        pageError: function() {
          var error = 'Error 2: ' + this.page.slug + '.' + this.page.format + ' failed to load';
          app.debug(error, 'warn');
          app.toast(error, 'http://blogdown.info/error/2', '_blank');
        },
        
        _loadPage: function() {
          switch (this.page.format) {
            case 'md':
              this.isMD = true;
              this.isHTML = false;
              this.isPDF = false;
              break;
            case 'html':
              this.isMD = false;
              this.isHTML = true;
              this.isPDF = false;
              break;
            case 'pdf':
              this.isMD = false;
              this.isHTML = false;
              this.isPDF = true;
              break;
          }
          app.debug(this.page.slug + '.' + this.page.format + ' loaded');
        },
        
        _download: function() {
          window.open(this.pageUrl);
        }
      });
    })();
  </script>

</dom-module>
