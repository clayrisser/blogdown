<dom-module id="boot-theme">
  <script>
    class BootTheme {
      beforeRegister() {
        this.is = 'boot-theme';

        this.properties = {
          settings: {
            type: Object,
            statePath: 'settings'
          }
        };
      }

      get behaviors() {
        return [ReduxState];
      }

      init() {
        const theme = this.settings.theme;
        this.theme = _.isString(theme) ? theme : theme[0];
        return this.importTheme().then(() => {
          app.runHook('themeImported');
          return;
        });
      }

      importTheme() {
        return this.importHrefPromise(
          `${app.baseUrl}/content/themes/${this.theme}/theme-body.html`
          + `?${app.getTimestamp()}`
        ).then(() => {
          if (document.createElement('theme-body')._minified) return Promise.resolve();
          return this.importHrefPromise(
            `${app.baseUrl}/content/themes/${this.theme}/theme-page.html`
            + `?${app.getTimestamp()}`
          ).then(() => {
            return this.importHrefPromise(
              `${app.baseUrl}/content/themes/${this.theme}/theme-posts.html`
              + `?${app.getTimestamp()}`
            );
          }).then(() => {
            return this.importHrefPromise(
              `${app.baseUrl}/content/themes/${this.theme}/theme-post.html`
              + `?${app.getTimestamp()}`
            );
          });
        });
      }

      importHrefPromise(url) {
        return new Promise((resolve, reject) => {
          this.importHref(url, () => {
            resolve();
          }, (err) => {
            reject(err);
          });
        });
      }
    }
    Polymer(BootTheme);
  </script>
</dom-module>
