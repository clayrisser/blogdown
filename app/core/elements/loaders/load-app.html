<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="load-app">
  <template>
  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'load-app',

        properties: {
          jobs: {
            type: Array,
            value: [
              'loadSettings',
              'loadGlobals',
              'loadAuthors',
              'loadPages',
              'loadTaxonomies',
              'loadTheme',
              'loadStyle'
            ]
          }
        },

        ready: function() {
          this.runJobs();
        },

        runJobs: function() {
          var jobsArray = [];
          _.each(this.jobs, function(job) {
            jobsArray.push(this[job].bind(this));
          }.bind(this));
          var promiseChain = Promise.resolve();
          for (var job of jobsArray) {
            promiseChain = promiseChain.then(job);
          }
          promiseChain.then(function() {
            this.loaded();
          }.bind(this)).catch(function(err) {
            console.error(err);
          }.bind(this));
        },

        loadSettings: function() {
          var loadSettings = document.createElement('load-settings');
          return loadSettings.load().then(function(settings) {
            return;
          }).catch(function(err) {
            throw err;
          });
        },

        loadGlobals: function() {
          var loadGlobals = document.createElement('load-globals');
          return loadGlobals.load().then(function(globals) {
            return globals;
          }).catch(function(err) {
            throw err;
          });
        },

        loadAuthors: function() {
          var loadAuthors = document.createElement('load-authors');
          return loadAuthors.load().then(function(authors) {
            return;
          }).catch(function(err) {
            throw err;
          });
        },

        loadPages: function(resolve) {
          var loadPages = document.createElement('load-pages');
          return loadPages.load().then(function(pages) {
            return;
          }).catch(function(err) {
            throw err;
          });
        },

        loadTaxonomies: function(resolve) {
          var loadTaxonomies = document.createElement('load-taxonomies');
          loadTaxonomies.load().then(function(taxonomies) {
            return;
          }).catch(function(err) {
            throw err;
          });
        },

        loadTheme: function(resolve) {
          var loadTheme = document.createElement('load-theme');
          loadTheme.load().then(function() {
            return;
          }).catch(function(err) {
            throw err;
          });
        },

        loadStyle: function(resolve) {
          var loadStyle = document.createElement('load-style');
          loadStyle.load().then(function() {
            return;
          }).catch(function(err) {
            throw err;
          });
        },

        loaded: function() {
          console.log('app.settings =>');
          console.log(app.settings);
          console.log('app.authors =>');
          console.log(app.authors);
          console.log('app.pages =>');
          console.log(app.pages);
          console.log('app.taxonomies =>');
          console.log(app.taxonomies);
          window.setTimeout(function() {
            app.appLoaded();
            app.debug(app.settings.title + ' loaded');
          }, 1000);
        }
      });
    })();
  </script>
</dom-module>
