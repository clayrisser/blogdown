<script src="../bower_components/page/page.js"></script>

<script>
  window.addEventListener('WebComponentsReady', () => {
    if (window.location.port === '') {
      page.base(app.baseUrl.replace(/\/$/, ''));
    }

    function middleware(ctx, next) {
      next();
    }

    page('*', middleware, (ctx, next) => {
      next();
    });

    page('/', (req) => {
      store.dispatch({
        type: CHANGE_ROUTE,
        route: {
          type: 'parent',
          slugs: {
            parent: 'home'
          }
        }
      });
    });

    page(app.baseUrl, (req) => {
      store.dispatch({
        type: CHANGE_ROUTE,
        route: {
          type: 'parent',
          slugs: {
            parent: 'home'
          }
        }
      });
    });

    page('/:parent', (req) => {
      store.dispatch({
        type: CHANGE_ROUTE,
        route: {
          type: 'parent',
          slugs: req.params
        }
      });
    });

    page('/:parent/:child', (req) => {
      store.dispatch({
        type: CHANGE_ROUTE,
        route: {
          type: 'child',
          slugs: req.params
        }
      });
    });

    page('*', (req) => {
      store.dispatch({
        type: CHANGE_ROUTE,
        route: {
          type: 'parent',
          slugs: {
            parent: '404'
          }
        }
      });
    });

    page({
      hashbang: true
    });
  });
</script>
