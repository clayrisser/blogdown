<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="handle-content">
  <template>

    <template is="dom-if" if="[[_isEqual(route.type, 'parent')]]" restamp>
      <handle-parent page="[[page]]"></handle-parent>
    </template>

    <template is="dom-if" if="[[_isEqual(route.type, 'child')]]" restamp>
      <handle-child post="[[post]]"></handle-child>
    </template>

  </template>
  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'handle-content',

        behaviors: [ ReduxBehavior ],

        properties: {
          route: {
            type: Object,
            statePath: 'route',
            observer: 'routeChanged'
          },
          pages: {
            type: Array,
            statePath: 'pages'
          },
          taxonomies: {
            type: Object,
            statePath: 'taxonomies'
          },
          appLoaded: {
            type: Boolean,
            statePath: 'meta.appLoaded',
            observer: 'routeChanged'
          }
        },

        routeChanged: function() {
          if (this.appLoaded) {
            switch(this.route.type) {
              case 'parent':
                var page = _.filter(this.pages, (page) => {
                  return page.slug === this.route.slugs.parent;
                })[0];
                if (page) {
                  this.set('page', page);
                } else {
                  app.log.warn('404 error');
                  app.go.to('/404');
                }
                break;
              case 'child':
                var post = _.filter(this.taxonomies[this.route.slugs.parent], (post) => {
                  return post.slug === this.route.slugs.child;
                })[0];
                if (post) {
                  this.set('post', post);
                } else {
                  app.log.warn('404 error');
                  app.go.to('/404');
                }
                break;
              default:
                app.log.warn('404 error');
                app.go.to('/404');
                break;
            }
          }
        },

        _isEqual: function(left, right) {
          return left === right;
        }
      });
    })();
  </script>
</dom-module>
