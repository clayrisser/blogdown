<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="post-dyn">
  <template></template>
  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'post-dyn',

        behaviors: [
          ReduxBehavior,
          ReduxActions
        ],

        properties: {
          post: {
            type: Object,
            value: {}
          },
          parent: {
            type: String,
            value: ''
          },
          body: {
            type: String,
            value: ''
          },
          format: {
            type: String,
            value: 'dyn.html'
          }
        },

        ready: function() {
          Polymer.dom(this.root).innerHTML = '<dyn-' + this.post.slug + '>';
          this._loadElement(this.post.slug, this.format, this.parent).then(() => {
            this.dispatch('appLoading', false);
          });;
        },

        _loadElement: function(name, format, parent) {
          return new Promise((resolve, reject) => {
            this.importHref('../content/' + parent + '/' + name + '.' + format, () => {
              app.log.info(parent + '/' + name + '.' + format + ' was imported.');
              resolve();
            }, (err) => {
              app.log.error(name + '.' + format + ' import failed to load');
              resolve();
            });
          });
        }
      });
    })();
  </script>
</dom-module>
